<h1 id="webhooks">Webhooks</h1>

<p>Every event on ShopRunBack can trigger a webhook.</p>

<p>Basically, a webhook is a JSON Object send by HTTP (POST) to an URL you have set on your account.</p>

<p>The server expect a 200 response (<code class="prettyprint">HTTP OK</code>) when posting the webhook, otherwise it is marked as not received successfully on the dashboard.</p>

<p><a href="https://staging.dashboard.shoprunback.com/en/webhooks">Go to the webhooks dashboard</a>.</p>

<h2 id="list">List</h2>

<table><thead>
<tr>
<th>Webhook name</th>
<th>Trigger</th>
</tr>
</thead><tbody>
<tr>
<td>collaborator.created</td>
<td>Sent when a collaborator creates its account</td>
</tr>
<tr>
<td>collaborator.invited</td>
<td>Sent when a manager invite a collaborator</td>
</tr>
<tr>
<td>product.created</td>
<td>Sent when a product is created in the catalogue</td>
</tr>
<tr>
<td>relocation.created</td>
<td>Sent when a new relocation rule has been created</td>
</tr>
<tr>
<td>returneditem.missing</td>
<td>Sent when a returned item is marked as missing by an operator</td>
</tr>
<tr>
<td>returneditem.relocated</td>
<td>Sent when a returned item is relocated to the retailer&rsquo;s warehouse</td>
</tr>
<tr>
<td>returneditem.transiting</td>
<td>Sent when a returned item is transitting</td>
</tr>
<tr>
<td>shipback.paid</td>
<td>Sent when a shipback is registered (the customer has paid or validated is free return) and the customer can download its voucher and label</td>
</tr>
<tr>
<td>shipback.relocated</td>
<td>Sent when all the returned item&rsquo;s of a shipback are relocated to the retailer&rsquo;s warehouse</td>
</tr>
<tr>
<td>shipback.transiting</td>
<td>Sent when all returned item&rsquo;s of a shipback are transiting</td>
</tr>
<tr>
<td>sponsoring.created</td>
<td>Sent when a new sponsoring rule has been created</td>
</tr>
<tr>
<td>warehouse.created</td>
<td>Sent when a new warehouse is added to the company</td>
</tr>
</tbody></table>

<p><aside class="notice">
  If you want to track a specific event and you don&rsquo;t find the appropriate webhooks above, please contact julien <em>at</em> shoprunback <em>dot</em> com.</p>

<p>If accurate, the webhook can be added to the platform in the next release.
</aside></p>

<h2 id="data-sent">Data sent</h2>
<pre class="highlight ruby tab-ruby"><code>  <span class="c1"># Example of JSON sent:</span>
  <span class="p">{</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span>
    <span class="s2">"event"</span><span class="p">:</span> <span class="s2">"shipback.relocated"</span><span class="p">,</span>
    <span class="s2">"created_at"</span><span class="p">:</span> <span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"id"</span><span class="o">=&gt;</span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span>
      <span class="s2">"mode"</span><span class="o">=&gt;</span><span class="s2">"postal"</span><span class="p">,</span>
      <span class="p">(.</span><span class="nf">.</span><span class="o">.</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>
  <span class="c1">// Example of JSON sent:
</span>  <span class="p">{</span>
    <span class="s2">"id"</span><span class="o">:</span> <span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span>
    <span class="s2">"event"</span><span class="o">:</span> <span class="s2">"shipback.relocated"</span><span class="p">,</span>
    <span class="s2">"created_at"</span><span class="o">:</span> <span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span>
    <span class="s2">"data"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">"id"</span><span class="o">=&gt;</span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span>
      <span class="s2">"mode"</span><span class="o">=&gt;</span><span class="s2">"postal"</span><span class="p">,</span>
      <span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre><pre class="highlight shell tab-shell"><code>  <span class="c"># Example of JSON sent:</span>
  <span class="o">{</span>
    <span class="s2">"id"</span>: <span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span>,
    <span class="s2">"event"</span>: <span class="s2">"shipback.relocated"</span>,
    <span class="s2">"created_at"</span>: <span class="s2">"2018-02-20 16:54:22 +0100"</span>,
    <span class="s2">"data"</span>: <span class="o">{</span>
      <span class="s2">"id"</span><span class="o">=</span>&gt;<span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span>,
      <span class="s2">"mode"</span><span class="o">=</span>&gt;<span class="s2">"postal"</span>,
      <span class="o">(</span>...<span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre>
<p>All webhooks has the same caracteristics; this is a JSON Object with the attributes:</p>

<ul>
<li>the <code class="prettyprint">id</code>: a unique identifier. You can use it to detect duplicate.</li>
<li>the name of the <code class="prettyprint">event</code> with the format: <code class="prettyprint">&lt;object trigerring the webhook&gt;.&lt;action&gt;</code></li>
<li>the date of the event which is also the date of creation of the webhook: <code class="prettyprint">created_at</code></li>
<li>the object triggering the webhook as a JSON in the <code class="prettyprint">data</code> attribute.</li>
</ul>

<h2 id="set-the-url">Set the URL</h2>
<pre class="highlight ruby tab-ruby"><code>
  <span class="c1"># in a Rake base application controller</span>
  <span class="k">def</span> <span class="nf">webhook</span>
    <span class="c1"># handle the webhook content with params</span>
    <span class="n">head</span> <span class="mi">200</span> <span class="c1"># HTTP OK</span>
  <span class="k">end</span>
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

  <span class="c1">// in a PHP Framework controller
</span>  <span class="k">private</span> <span class="k">function</span> <span class="nf">webhook</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="nv">$webhook</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"php://input"</span><span class="p">);</span>
    <span class="nv">$webhook</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$webhook</span><span class="p">);</span> <span class="c1">// the webhook data in an associative array
</span>
    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">returnHeaderHTTP</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">//example in Prestashop
</span>  <span class="p">}</span>

<span class="cp">?&gt;</span>
</code></pre>
<p>The ShopRunBack&rsquo;s API send the webhooks on a public accessible HTTP or HTTPS endpoint (the certificate must be valid).</p>

<p>If you want to protect this endpoint, you can :</p>

<ul>
<li>setup a basic authentication and provide the login and passoword in the URL (<code class="prettyprint">http://&lt;login&gt;:&lt;password&gt;@host.com</code>)</li>
<li>verify the value of a specific URL parameter and provide it in the webhook URL (<code class="prettyprint">http://host.com?shoprunback=topsecret</code>)</li>
</ul>

<p>You can set your Wehbook URL on the dashboard, in the <a href="https://dashboard.shoprunback.com/webhooks/edit">section Developers &gt; Webhooks</a>.</p>

<h2 id="volume">Volume</h2>

<p>The volume of webhooks increase with the amount of shipbacks ShopRunBack will handle for you.</p>

<p>Please make sure your server and the application which provides the endpoint can handle all the requests.</p>

<p>If you don&rsquo;t use the webhooks, don&rsquo;t provide any webhooks URL and the platform will not send it.</p>
