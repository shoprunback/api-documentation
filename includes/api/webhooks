<h1 id="webhooks">Webhooks</h1>

<p>Every event on ShopRunBack can trigger a webhook.</p>

<p>Basically, a webhook is a JSON Object send by HTTP (POST) to an URL you have set on your account.</p>

<p>The server expect a 200 response (<code class="prettyprint">HTTP OK</code>) when posting the webhook, otherwise it is marked as not received successfully on the dashboard.</p>

<p><a href="https://dashboard.shoprunback.com/en/webhooks">Go to the webhooks dashboard</a>.</p>

<h2 id="data-sent">Data sent</h2>
<pre class="highlight json tab-json"><code><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">Example</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">sent</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shipback.relocated"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"postal"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre>
<p>All webhooks has the same caracteristics; this is a JSON Object with the attributes:</p>

<ul>
<li>the <code class="prettyprint">id</code>: a unique identifier. You can use it to detect duplicate.</li>
<li>the name of the <code class="prettyprint">event</code> with the format: <code class="prettyprint">&lt;object trigerring the webhook&gt;.&lt;action&gt;</code></li>
<li>the date of the event which is also the date of creation of the webhook: <code class="prettyprint">created_at</code></li>
<li>the object triggering the webhook as a JSON in the <code class="prettyprint">data</code> attribute.</li>
</ul>

<p><aside class="notice">
  If you want to track a specific event and you don&rsquo;t find the appropriate webhooks above, please contact julien <em>at</em> shoprunback <em>dot</em> com.</p>

<p>If accurate, the webhook can be added to the platform in the next release.
</aside></p>

<h3 id="collaborator">Collaborator</h3>
<pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Example</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">sent</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"collaborator.invited"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"email"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tim@apple.com"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span></code></pre>
<table><thead>
<tr>
<th>Webhook name</th>
<th>Trigger</th>
</tr>
</thead><tbody>
<tr>
<td>collaborator.created</td>
<td>Sent when a collaborator creates its account</td>
</tr>
<tr>
<td>collaborator.invited</td>
<td>Sent when a manager invite a collaborator</td>
</tr>
</tbody></table>

<h3 id="product">Product</h3>
<pre class="highlight json tab-json"><code><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Example</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">sent</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"product.created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"label"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Iphone 12S - Blue"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IPHONE-12S"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"ean"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1237492402485"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span></code></pre>
<table><thead>
<tr>
<th>Webhook name</th>
<th>Trigger</th>
</tr>
</thead><tbody>
<tr>
<td>product.created</td>
<td>Sent when a product is created in the catalogue</td>
</tr>
</tbody></table>

<h3 id="relocation">Relocation</h3>
<pre class="highlight json tab-json"><code><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">Example</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">sent</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"relocation.created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"country_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"FR"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"reason_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"damaged"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"warehoused_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c699"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span></code></pre>
<table><thead>
<tr>
<th>Webhook name</th>
<th>Trigger</th>
</tr>
</thead><tbody>
<tr>
<td>relocation.created</td>
<td>Sent when a new relocation rule has been created</td>
</tr>
</tbody></table>

<h3 id="returned-item">Returned Item</h3>
<pre class="highlight json tab-json"><code><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">Example</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">sent</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"returneditem.relocated"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"reason_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"damaged"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"item"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c600"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"barcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12149837489"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Iphone 12S - Blue"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IPHONE-12S"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span></code></pre>
<table><thead>
<tr>
<th>Webhook name</th>
<th>Trigger</th>
</tr>
</thead><tbody>
<tr>
<td>returneditem.missing</td>
<td>Sent when a returned item is marked as missing by an operator</td>
</tr>
<tr>
<td>returneditem.relocated</td>
<td>Sent when a returned item is relocated to the retailer&rsquo;s warehouse</td>
</tr>
<tr>
<td>returneditem.transiting</td>
<td>Sent when a returned item is transitting</td>
</tr>
</tbody></table>

<h3 id="shipback">Shipback</h3>
<pre class="highlight json tab-json"><code><span class="w">
  </span><span class="err">#</span><span class="w"> </span><span class="err">Example</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">sent</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">shipback.registered</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shipback.registered"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"rma"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"registered_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:58:22 +0100"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"postal"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"weight_in_grams"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"size"</span><span class="p">:</span><span class="w"> </span><span class="s2">"S"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"computed_weight_in_grams"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"public_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://web.shoprunback.com/apple/1234"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
      </span><span class="s2">"price_cents"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"customer_price_cents"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10000"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="err">#</span><span class="w"> </span><span class="err">Example</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">sent</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">shipback.labelled</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shipback.labelled"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"rma"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"registered_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:58:22 +0100"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"postal"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"weight_in_grams"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"size"</span><span class="p">:</span><span class="w"> </span><span class="s2">"S"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"computed_weight_in_grams"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"public_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://web.shoprunback.com/apple/1234"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
      </span><span class="s2">"price_cents"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"customer_price_cents"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10000"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"label_url"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://cdn.com/label/1234.pdf"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="err">//</span><span class="w"> </span><span class="err">Example</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">sent</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">events</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shipback.registered"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"rma"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="p">,</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span></code></pre>
<table><thead>
<tr>
<th>Webhook name</th>
<th>Trigger</th>
</tr>
</thead><tbody>
<tr>
<td>shipback.created</td>
<td>Sent when a shipback is created (via the API or via the web interface)</td>
</tr>
<tr>
<td>shipback.registering</td>
<td>Sent when a customer has visited the return link</td>
</tr>
<tr>
<td>shipback.registered</td>
<td>Sent when a shipback is registered (the customer has paid or validated is free return) and the customer can download its voucher and label</td>
</tr>
<tr>
<td>shipback.labelled</td>
<td>Sent when the label is available</td>
</tr>
<tr>
<td>shipback.delivering</td>
<td>Sent when the shipback is transiting between the customer&rsquo;s location and our warehouse</td>
</tr>
<tr>
<td>shipback.delivered</td>
<td>Sent when the shipback is delivered to our warehouse</td>
</tr>
<tr>
<td>shipback.identified</td>
<td>Sent when the incoming parcel has been open and all returned items have been identified with a unique barcode or marked has missing (not returned)</td>
</tr>
<tr>
<td>shipback.relocating</td>
<td>Sent when the shipback is transitting from our warehouse to the retailer&rsquo;s warehouse</td>
</tr>
<tr>
<td>shipback.relocated</td>
<td>Sent when all the returned item&rsquo;s of a shipback are relocated to the retailer&rsquo;s warehouse</td>
</tr>
<tr>
<td>shipback.failed</td>
<td>Sent when something went wront with this shipback</td>
</tr>
</tbody></table>

<h3 id="sponsoring">Sponsoring</h3>
<pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Example</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">sent</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sponsoring.created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"percentage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"100"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"country_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FR"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"reason_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"damaged"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"merchant_fee_min"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="s2">"merchant_fee_max"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
      </span><span class="s2">"customer_fee_min"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="s2">"customer_fee_max"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span></code></pre>
<table><thead>
<tr>
<th>Webhook name</th>
<th>Trigger</th>
</tr>
</thead><tbody>
<tr>
<td>sponsoring.created</td>
<td>Sent when a new sponsoring rule has been created</td>
</tr>
</tbody></table>

<h3 id="warehouse">Warehouse</h3>
<pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Example</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">sent</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"00082f23-9b8c-4515-b1cd-527d56a1bef3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"event"</span><span class="p">:</span><span class="w"> </span><span class="s2">"warehouse.created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-02-20 16:54:22 +0100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fc8520bf-3ae0-46b1-8991-cacb6b03c698"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"APPLE01"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Apple store Paris"</span><span class="p">,</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span></code></pre>
<table><thead>
<tr>
<th>Webhook name</th>
<th>Trigger</th>
</tr>
</thead><tbody>
<tr>
<td>warehouse.created</td>
<td>Sent when a new warehouse is added to the company</td>
</tr>
</tbody></table>

<h2 id="set-the-url">Set the URL</h2>
<pre class="highlight ruby tab-ruby"><code>
  <span class="c1"># in a Rake base application controller</span>
  <span class="k">def</span> <span class="nf">webhook</span>
    <span class="c1"># handle the webhook content with params</span>
    <span class="n">head</span> <span class="mi">200</span> <span class="c1"># HTTP OK</span>
  <span class="k">end</span>
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

  <span class="c1">// in a PHP Framework controller
</span>  <span class="k">private</span> <span class="k">function</span> <span class="nf">webhook</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="nv">$webhook</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"php://input"</span><span class="p">);</span>
    <span class="nv">$webhook</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$webhook</span><span class="p">);</span> <span class="c1">// the webhook data in an associative array
</span>
    <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">returnHeaderHTTP</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">//example in Prestashop
</span>  <span class="p">}</span>

<span class="cp">?&gt;</span>
</code></pre>
<p>The ShopRunBack&rsquo;s API send the webhooks on a public accessible HTTP or HTTPS endpoint (the certificate must be valid).</p>

<p>If you want to protect this endpoint, you can :</p>

<ul>
<li>setup a basic authentication and provide the login and password in the URL (<code class="prettyprint">http://&lt;login&gt;:&lt;password&gt;@host.com</code>)</li>
<li>verify the value of a specific URL parameter and provide it in the webhook URL (<code class="prettyprint">http://host.com?shoprunback=topsecret</code>)</li>
<li>Use the build-in HMAC signature without altering the URL (see below)</li>
</ul>

<p>You can set your Wehbook URL on the dashboard, in the <a href="https://dashboard.shoprunback.com/webhooks/edit">section Developers &gt; Webhooks</a>.</p>

<h2 id="signature">Signature</h2>

<p>We include a signature in each webhooks sent by ShopRunBack in the <code class="prettyprint">Shoprunback-Signature</code> header.</p>

<h3 id="define-your-secret">Define your secret</h3>

<p>You can change the secret (the default one is empty) on your dashboard: <a href="https://dashboard.shoprunback.com/webhooks/edit">section Developers &gt; Webhooks</a>.</p>

<p>Use a random string with high entropy with, by example, the following command: <code class="prettyprint">ruby -rsecurerandom -e &#39;puts SecureRandom.hex(20)&#39;</code> in your terminal.</p>

<h3 id="verify-the-signature">Verify the signature</h3>
<pre class="highlight ruby tab-ruby"><code>  <span class="n">digest</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">)</span>
  <span class="n">secret</span> <span class="o">=</span> <span class="s2">"your secret"</span> <span class="c1"># empty string if not set</span>
  <span class="n">payload</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="nf">body</span><span class="p">.</span><span class="nf">read</span>

  <span class="c1"># signature</span>
  <span class="n">hmac</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">HMAC</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="n">secret</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

  <span class="c1"># verification</span>
  <span class="n">hmac</span> <span class="o">==</span> <span class="n">request</span><span class="p">.</span><span class="nf">env</span><span class="p">[</span><span class="s1">'HTTP_SHOPRUNBACK_SIGNATURE'</span><span class="p">]</span>
</code></pre><pre class="highlight php tab-php"><code><span class="cp">&lt;?php</span>

  <span class="nv">$secret</span> <span class="o">=</span> <span class="s2">"your secret"</span><span class="p">;</span> <span class="c1">// empty string if not set
</span>  <span class="nv">$payload</span> <span class="o">=</span> <span class="o">@</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'php://input'</span><span class="p">);</span>

  <span class="c1">// signature
</span>  <span class="nv">$hmac</span> <span class="o">=</span> <span class="nb">hash_hmac</span> <span class="p">(</span><span class="s1">'sha-256'</span><span class="p">,</span> <span class="nv">$body</span> <span class="p">,</span> <span class="nv">$secret</span><span class="p">)</span>

  <span class="c1">// verification
</span>  <span class="nv">$hmac</span> <span class="o">==</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_STRIPE_SIGNATURE'</span><span class="p">];</span>

<span class="cp">?&gt;</span>
</code></pre>
<p>ShopRunBack generates signatures using a hash-based message authentication code (HMAC) with SHA-256.</p>

<p>To verify this signature:</p>

<ol>
<li>Get the signature in the <code class="prettyprint">Shoprunback-Signature</code> header</li>
<li>Compare the header value with HMAC (SHA-256) of the request body</li>
</ol>

<p>The two signature must be the same otherwise you can reject this webhook.</p>

<h2 id="volume">Volume</h2>

<p>The volume of webhooks increase with the amount of shipbacks ShopRunBack will handle for you.</p>

<p>Please make sure your server and the application which provides the endpoint can handle all the requests.</p>

<p>If you don&rsquo;t use the webhooks, don&rsquo;t provide any webhooks URL and the platform will not send it.</p>
